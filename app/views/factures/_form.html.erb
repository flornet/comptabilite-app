<style type="text/css">
  .has-bg-primary-color {
    background-color: <%= @facture.contrast_color %> !important;
    color: #ffffff !important;
  }
  .has-text-primary-color {
    color: <%= @facture.contrast_color %> !important;
  }
</style>
<%
if current_page?(action: 'new')
  @creating_new = true
else
  @creating_new = false
end %>

<%= form_with(model: facture, html: {autocomplete: "off"}) do |form| %>
  <% if @creating_new %>
    <%= form.hidden_field :facture_statut_id%>
  <% else %>
    <div class="field">
      <%= form.label :facture_statut_id, class: "label" %>
      <div class="select">
        <%= form.collection_select :facture_statut_id, FactureStatut.order(:nom), :id, :nom%>
      </div>
    </div>
    <hr />
  <% end %>

  <div class="panel facture-actions">
    <div class="panel-block">
        <div class="buttons">
          <% if @creating_new %>
            <%= form.button "Sauvegarder en brouillon", name: 'commit', value: "brouillon", class: "button is-secondary is-fullwidth" %>
            <%= form.button "Créer la facture", name: 'commit', value: "facture", class: "button is-primary is-fullwidth" %>
          <% elsif @facture.est_brouillon %>
            <%= form.button "Enregistrer", name: 'commit',value: "brouillon", class: "button is-secondary is-fullwidth" %>
            <%= form.button "Créer la facture", name: 'commit', value: "facture", class: "button is-primary is-fullwidth" %>
          <% else %>
            <%= form.button "Enregistrer", name: 'commit', value: "facture", class: "button is-primary is-fullwidth" %>
          <% end %>
      </div>
    </div>
  </div>
  
    <div class="card facture-feuille">
        <% if facture.errors.any? %>
          <div class="notification is-danger">
            <h2 class="is-size-5"><%= pluralize(facture.errors.count, "error") %> prohibited this facture from being saved:</h2>
            <div class="content">
            <ul>
              <% facture.errors.each do |error| %>
                <li><%= error.full_message %></li>
              <% end %>
            </ul>
            </div>
          </div>
        <% end %>

        <div class="tile is-ancestor">
          <div class="tile is-4 is-parent">
            <div class="tile is-child">
              <div class="fournisseur">
                <%= render "factures/partials/fournisseur_form", form: form %>
              </div>
            </div>
          </div>
          <div class="tile is-8 is-parent">
            <div class="tile is-child">
              <div class="tile is-ancestor">
                <div class="tile is-3 is-parent">
                  <div class="tile is-child">
                  </div>
                </div>
                <div class="tile is-9 is-parent">
                  <div class="tile is-child">
                    <div class="client">
                      <%= form.fields_for :client do |client_form| %>
                        <%= render "factures/partials/client_form", form: client_form %>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>






        <div class="contenu-principal">
          <%= render "factures/partials/entete_form", form: form %>

          <div class="facture-lignes">
            <table class="table is-fullwidth is-narrow" id="table_lignes_facture">
              <thead>
                <tr>
                  <th class="has-text-left has-bg-primary-color" colspan="2">Désignation</th>
                  <th class="is-narrow has-bg-primary-color">Montant HT</th>
                </tr>
              </thead>
              <tbody>
              <%= form.fields_for :facture_lignes do |facture_ligne| %>
                  <%= render "factures/partials/facture_ligne_fields_form", f: facture_ligne %>
              <% end %>
              </tbody>
              <tfoot>
                <%= render "factures/partials/pied_form", form: form %>
              </tfoot>
            </table>
          </div>

          <div class="facture-mentions">
            <%= render "factures/partials/mentions_form", form: form %>
          </div>

        </div>

  </div>
<% end %>
